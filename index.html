<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Unblocked Games</title>
    <style>
        :root {
            --bg: #0b0b0b;
            --header-bg: #111;
            --text: #ffffff;
            --muted: #cccccc;
            --accent: #00f;
            --accent-dark: #007bff;
            --accent-shadow: rgba(0, 0, 255, 0.2);
            --card-bg: #000000;
            --card-radius: 10px;
            --card-shadow: 0 0 10px rgba(0, 0, 255, 0.2);
            --glow-size: 15px;
            --glow-strength: 0.25;
            --font-family: 'Arial Black', Arial, sans-serif;
            --snow-color: rgba(255, 255, 255, 0.95);
            --snow-count: 100;
            --snow-size: 2;
            --snow-speed: 1;
        }

        body {
            margin: 0;
            font-family: var(--font-family);
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .neon-text {
            font-size: 64px;
            font-weight: bold;
            text-transform: uppercase;
            animation: neonGlowBlue 2s ease-in-out infinite alternate;
            color: #00f;
            margin-top: 20px;
            text-align: center;
        }

        header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 800px;
            background: var(--header-bg);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            z-index: 100;
            box-shadow: 0 0 20px var(--accent-shadow);
            border-radius: 12px;
        }

        .search-container {
            display: flex;
            align-items: center;
            background: none;
            border: 2px solid #00f;
            padding: 10px 20px;
            border-radius: 50px;
            animation: neonGlowBlueInput 2s ease-in-out infinite alternate;
            flex: 1;
        }

        .search-container input {
            background: transparent;
            border: none;
            outline: none;
            color: #ffffff;
            font-size: 20px;
            width: 100%;
            font-family: 'Arial Black', sans-serif;
            caret-color: white;
        }

        .search-container input::placeholder {
            color: #ccccff;
        }

        .mindfind {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mindfind svg {
            width: 32px;
            height: 32px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }

        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            transition: background-color 5000s ease-in-out 0s;
            -webkit-text-fill-color: white !important;
            box-shadow: 0 0 0px 1000px transparent inset !important;
        }

        .btn {
            margin-top: 0;
            padding: 10px 20px;
            background-color: #00f;
            color: white;
            font-size: 16px;
            text-transform: uppercase;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'Arial Black', sans-serif;
        }

        .btn:hover {
            background-color: #007bff;
        }

        #discordBtn {
            background: #7289da;
        }

        #discordBtn:hover {
            background: #5b6eae;
        }

        #customizeBtn {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.06);
            color: var(--text);
            padding: 0.5rem;
            border-radius: 8px;
        }

        #gameInfo {
            padding: 8rem 2rem 0.5rem 2rem;
            color: var(--accent);
            font-weight: bold;
            font-size: 1rem;
            text-align: center;
        }

        #gameInfo p {
            margin: 0;
        }

        #gameContainer {
            padding: 0 2rem 2rem 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.8rem;
            justify-content: center;
        }

        .game-card {
            background: var(--card-bg);
            border-radius: var(--card-radius);
            padding: 1rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 250px;
            box-sizing: border-box;
            margin: 0 auto;
        }

        .game-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 calc(var(--glow-size)) rgba(0, 0, 255, var(--glow-strength));
        }

        .game-card img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        .game-card h2 {
            margin: 0.5rem 0 0;
            font-size: 1.1rem;
            text-align: center;
        }

        .game-card p {
            font-size: 0.9rem;
            color: var(--muted);
            text-align: center;
            margin-top: 0.3rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            justify-content: center;
            align-items: center;
            z-index: 999;
            overflow: auto;
        }

        .modal-content {
            background: var(--card-bg);
            max-width: 90vw;
            width: 900px;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            box-shadow: 0 0 25px var(--accent-shadow);
            text-align: center;
        }

        #gameTitle {
            margin: 0 0 1rem;
            color: var(--accent);
            font-size: 1.5rem;
        }

        #gameFrame {
            width: 100%;
            height: 60vh;
            border: 2px solid var(--accent);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .controls button {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            border: none;
            border-radius: 6px;
            color: #fff;
            padding: 0.8rem 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .controls button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--accent-shadow);
        }

        .modal-content button#closeModal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            color: #fff;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1;
            cursor: pointer;
            z-index: 1000;
            transition: background 0.2s, transform 0.2s;
        }

        .modal-content button#closeModal:hover {
            background: var(--accent-dark);
            transform: scale(1.1);
        }

        .settings-panel-large {
            display: none;
            position: fixed;
            top: 64px;
            right: 24px;
            width: 920px;
            max-width: calc(100% - 48px);
            background: var(--card-bg);
            color: var(--text);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
            z-index: 1200;
            padding: 14px;
            font-size: 14px;
            overflow: hidden;
        }

        .settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 10px;
            cursor: move;
        }

        .settings-title {
            font-size: 18px;
            color: var(--accent);
            margin: 0;
            font-weight: 700;
        }

        .settings-close {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            padding: 6px 10px;
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
        }

        .settings-body {
            max-height: 62vh;
            overflow: auto;
            padding-right: 8px;
        }

        .section {
            margin-bottom: 12px;
        }

        .section h4 {
            margin: 0 0 6px 0;
            color: var(--muted);
            font-size: 13px;
        }

        .row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .col {
            flex: 1;
            min-width: 180px
        }

        .label {
            display: block;
            margin-bottom: 6px;
            color: var(--muted);
            font-size: 13px
        }

        input[type="color"],
        input[type="range"],
        select,
        input[type="number"] {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.02);
            color: var(--text)
        }

        .small {
            width: 120px
        }

        .actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 8px
        }

        .btn-primary {
            background: var(--accent);
            border: none;
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer
        }

        .btn-ghost {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer
        }

        .footer {
            margin-top: 50px;
            padding: 20px;
            background-color: #000;
            color: #ccc;
            font-size: 14px;
            text-align: center;
            width: 100%;
        }

        @keyframes neonGlowBlue {
            from {
                text-shadow: 0 0 5px #fff, 0 0 15px #00f, 0 0 30px #00f, 0 0 60px #00f;
            }
            to {
                text-shadow: 0 0 10px #fff, 0 0 20px #00f, 0 0 40px #00f, 0 0 80px #00f;
            }
        }

        @keyframes neonGlowBlueInput {
            from {
                box-shadow: 0 0 5px #fff, 0 0 15px #00f, 0 0 30px #00f;
            }
            to {
                box-shadow: 0 0 10px #fff, 0 0 25px #00f, 0 0 50px #00f;
            }
        }

        @media (max-width:980px) {
            .settings-panel-large {
                left: 12px;
                right: 12px;
                top: 72px;
                width: calc(100% - 24px)
            }
        }

        @media (max-width: 768px) {
            .neon-text {
                font-size: 48px;
                margin-top: 80px;
            }
            
            header {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            
            .search-container {
                order: 1;
                width: 100%;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    
    <div class="neon-text">Free Unblocked Games</div>
    
    <header>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search games...">
            <button onclick="searchElite()" class="mindfind">
                <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
            </button>
        </div>
        <button class="btn" onclick="window.open('https://sites.google.com/ahschools.us/free-math-gamess/contact-us?authuser=0', '_blank')">Contact Us</button>
        <button class="btn" onclick="window.open('https://sites.google.com/ahschools.us/free-math-gamess/form?authuser=0', '_blank')">Form</button>
        <button class="btn" id="discordBtn">Join Discord</button>
        <button class="btn" id="customizeBtn">Customize</button>
    </header>
    
    <div id="gameInfo">
        <p>Games: 0</p>
    </div>
    
    <div id="gameContainer"></div>
    
    <div class="modal" id="gameModal">
        <div class="modal-content">
            <button id="closeModal">&times;</button>
            <h2 id="gameTitle"></h2>
            <iframe id="gameFrame" src="" frameborder="0"></iframe>
            <div class="controls">
                <button id="downloadBtn">Download</button>
                <button id="fullscreenBtn">Fullscreen</button>
                <button id="aboutBlankBtn">Open in About:blank</button>
                <button id="blobBtn">Open in Blob URL</button>
            </div>
        </div>
    </div>
    
    <div class="settings-panel-large" id="settingsPanel" role="dialog" aria-label="Site customization">
        <div class="settings-header" id="settingsDrag">
            <div style="display:flex;gap:12px;align-items:center">
                <span class="settings-title">Site Customization</span>
                <small style="color:var(--muted)">(drag header to move)</small>
            </div>
            <div></div>
        </div>
        <div class="settings-body">
            <div class="section">
                <h4>Presets & Quick Actions</h4>
                <div class="row">
                    <div class="col" style="display:flex;gap:8px;flex-wrap:wrap">
                        <button class="btn-primary" data-preset="Inferno">Inferno</button>
                        <button class="btn-primary" data-preset="mathias">mathias</button>
                        <button class="btn-primary" data-preset="kirby">kirby</button>
                        <button class="btn-primary" data-preset="Ocean">Ocean</button>
                        <button class="btn-primary" data-preset="Neon">Neon</button>
                        <button class="btn-primary" data-preset="Retro">Retro</button>
                        <button class="btn-ghost" data-preset="Dark">Dark</button>
                        <button class="btn-ghost" data-preset="Light">Light</button>
                    </div>
                    <div class="col" style="display:flex;justify-content:flex-end;align-items:center">
                        <button class="btn-primary" id="exportBtn">Export JSON</button>
                        <button class="btn-ghost" id="importBtn">Import JSON</button>
                        <input type="file" id="importFile" accept=".json" style="display:none" />
                        <button class="btn-ghost" id="resetBtn">Reset Defaults</button>
                    </div>
                </div>
            </div>
            <div class="section">
                <h4>Colors & Typography</h4>
                <div class="row">
                    <div class="col">
                        <label class="label">Background color</label>
                        <input id="bgColor" type="color" value="#0b0b0b">
                    </div>
                    <div class="col">
                        <label class="label">Header color</label>
                        <input id="headerColor" type="color" value="#111111">
                    </div>
                    <div class="col">
                        <label class="label">Text color</label>
                        <input id="textColor" type="color" value="#ffffff">
                    </div>
                    <div class="col">
                        <label class="label">Muted / Secondary text</label>
                        <input id="mutedColor" type="color" value="#cccccc">
                    </div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col">
                        <label class="label">Accent color</label>
                        <input id="accentColor" type="color" value="#0000ff">
                    </div>
                    <div class="col">
                        <label class="label">Accent dark</label>
                        <input id="accentDark" type="color" value="#007bff">
                    </div>
                    <div class="col">
                        <label class="label">Glow (shadow) color</label>
                        <input id="glowColor" type="color" value="#0000ff">
                    </div>
                    <div class="col">
                        <label class="label">Card background</label>
                        <input id="cardBg" type="color" value="#000000">
                    </div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col">
                        <label class="label">Font family</label>
                        <select id="fontFamily">
                            <option value="'Arial Black', Arial, sans-serif">Arial Black</option>
                            <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                            <option value="'Roboto', Arial, sans-serif">Roboto</option>
                            <option value="'VT323', monospace">VT323 (gamey)</option>
                            <option value="'Press Start 2P', cursive">Press Start (pixel)</option>
                        </select>
                    </div>
                    <div class="col">
                        <label class="label">Card radius (px)</label>
                        <input id="cardRadius" type="range" min="0" max="40" value="10">
                    </div>
                    <div class="col">
                        <label class="label">Glow size (px)</label>
                        <input id="glowSize" type="range" min="4" max="60" value="15">
                    </div>
                    <div class="col">
                        <label class="label">Glow strength (0-1)</label>
                        <input id="glowStrength" type="range" min="0" max="1" step="0.01" value="0.25">
                    </div>
                </div>
            </div>
            <div class="section">
                <h4>Starfield & Particles</h4>
                <div class="row">
                    <div class="col">
                        <label class="label">Star color</label>
                        <input id="starColor" type="color" value="#ffffff">
                    </div>
                    <div class="col">
                        <label class="label">Star count: <span id="starCountLabel">100</span></label>
                        <input id="starCount" type="range" min="0" max="400" value="100">
                    </div>
                    <div class="col">
                        <label class="label">Star size: <span id="starSizeLabel">2</span></label>
                        <input id="starSize" type="range" min="1" max="10" value="2">
                    </div>
                    <div class="col">
                        <label class="label">Star speed: <span id="starSpeedLabel">1</span></label>
                        <input id="starSpeed" type="range" min="0.2" max="4" step="0.1" value="1">
                    </div>
                </div>
            </div>
        </div>
        <div class="actions">
            <button class="btn-ghost" id="applyBtn">Apply (autosaves)</button>
            <button class="btn-primary" id="saveBtn">Save</button>
        </div>
    </div>
    
    <div class="footer">
        <p><strong>Coincidence is God's way of remaining anonymous</strong></p>
        <p>Please don't tell too much people about this, this might get blocked chat :(</p>
        <p>This is a website where you can play unblocked games and have fun in school. If this gets blocked, I'm making another site chat, okay? Now go play those games! Games you can play are:</p>
        <p>Mario Kart, Super Circuit, 1v1.lol, Boxing, Random Eaglercraft 1.12 and 1.8, Retro Bowl, and more!</p>
    </div>

    <script>
        // Search function
        function searchElite() {
            const query = document.getElementById('searchInput').value.trim();
            if (query !== '') {
                const url = 'https://sites.google.com/search/unblockedgamesforschools?query=' + encodeURIComponent(query);
                window.open(url, '_blank');
            }
        }

        document.getElementById('searchInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                searchElite();
            }
        });

        // Starfield animation
        const canvas = document.getElementById('starfield');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const stars = [];
        const starCount = 100;

        for (let i = 0; i < starCount; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2 + 1,
                speed: Math.random() * 0.5 + 0.1
            });
        }

        function animateStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            for (let star of stars) {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            }
            requestAnimationFrame(animateStars);
        }

        animateStars();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Customization system
        var DEFAULTS = {
            bg:'#0b0b0b',
            header:'#111111',
            text:'#ffffff',
            muted:'#cccccc',
            accent:'#0000ff',
            accentDark:'#007bff',
            glowColor:'#0000ff',
            cardBg:'#000000',
            cardRadius:10,
            glowSize:15,
            glowStrength:0.25,
            fontFamily:"'Arial Black', Arial, sans-serif",
            starColor:'#ffffff',
            starCount:100,
            starSize:2,
            starSpeed:1
        };

        var customizeBtn = document.getElementById('customizeBtn');
        var settingsPanel = document.getElementById('settingsPanel');
        var settingsDrag = document.getElementById('settingsDrag');
        var bgColor = document.getElementById('bgColor');
        var headerColor = document.getElementById('headerColor');
        var textColor = document.getElementById('textColor');
        var mutedColor = document.getElementById('mutedColor');
        var accentColor = document.getElementById('accentColor');
        var accentDark = document.getElementById('accentDark');
        var glowColor = document.getElementById('glowColor');
        var cardBg = document.getElementById('cardBg');
        var cardRadius = document.getElementById('cardRadius');
        var glowSize = document.getElementById('glowSize');
        var glowStrength = document.getElementById('glowStrength');
        var fontFamily = document.getElementById('fontFamily');
        var starColor = document.getElementById('starColor');
        var starCount = document.getElementById('starCount');
        var starSize = document.getElementById('starSize');
        var starSpeed = document.getElementById('starSpeed');
        var starCountLabel = document.getElementById('starCountLabel');
        var starSizeLabel = document.getElementById('starSizeLabel');
        var starSpeedLabel = document.getElementById('starSpeedLabel');
        var applyBtn = document.getElementById('applyBtn');
        var saveBtn = document.getElementById('saveBtn');
        var resetBtn = document.getElementById('resetBtn');
        var exportBtn = document.getElementById('exportBtn');
        var importBtn = document.getElementById('importBtn');
        var importFile = document.getElementById('importFile');

        function hexToRGBA(hex, alpha){
            if(!alpha) alpha = 1;
            if(!hex) return 'rgba(255,255,255,'+alpha+')';
            var h = hex.replace('#','');
            var num = parseInt(h,16);
            var r = (num >> 16) & 255;
            var g = (num >> 8) & 255;
            var b = num & 255;
            return 'rgba('+r+','+g+','+b+','+alpha+')';
        }

        function applySettings(s){
            var settings = {};
            for(var k in DEFAULTS){
                settings[k] = DEFAULTS[k];
            }
            if(s){
                for(var k in s){
                    settings[k] = s[k];
                }
            }

            document.documentElement.style.setProperty('--bg', settings.bg);
            document.documentElement.style.setProperty('--header-bg', settings.header);
            document.documentElement.style.setProperty('--text', settings.text);
            document.documentElement.style.setProperty('--muted', settings.muted);
            document.documentElement.style.setProperty('--accent', settings.accent);
            document.documentElement.style.setProperty('--accent-dark', settings.accentDark);
            document.documentElement.style.setProperty('--accent-shadow', hexToRGBA(settings.glowColor,0.3));

            var cards = document.querySelectorAll('.game-card');
            for(var i=0; i<cards.length; i++){
                cards[i].style.boxShadow = '0 0 '+settings.glowSize+'px '+hexToRGBA(settings.glowColor, settings.glowStrength);
            }

            document.documentElement.style.setProperty('--card-bg', settings.cardBg);
            document.documentElement.style.setProperty('--card-radius', settings.cardRadius+'px');
            document.documentElement.style.setProperty('--card-shadow', '0 0 '+Math.max(6,settings.glowSize/1.6)+'px '+hexToRGBA(settings.glowColor,0.12));
            document.documentElement.style.setProperty('--glow-size', settings.glowSize+'px');
            document.documentElement.style.setProperty('--glow-strength', settings.glowStrength);
            document.documentElement.style.setProperty('--font-family', settings.fontFamily);

            document.body.style.background = settings.bg;
            document.body.style.color = settings.text;

            var header = document.querySelector('header');
            if(header){
                header.style.background = settings.header;
            }

            var allCards = document.querySelectorAll('.game-card');
            for(var i=0; i<allCards.length; i++){
                allCards[i].style.background = settings.cardBg;
            }

            var gf = document.getElementById('gameFrame');
            if(gf){
                gf.style.borderColor = settings.accent;
            }

            // Update starfield
            updateStarfield(settings.starCount, settings.starSize, settings.starSpeed, settings.starColor);
        }

        function saveSettings(obj){
            localStorage.setItem('free_unblocked_games_theme', JSON.stringify(obj));
            saveBtn.textContent = 'Saved âœ“';
            setTimeout(function(){
                saveBtn.textContent = 'Save';
            }, 900);
        }

        function loadSettings(){
            var raw = localStorage.getItem('free_unblocked_games_theme');
            if(!raw){
                return DEFAULTS;
            }
            try {
                var parsed = JSON.parse(raw);
                var result = {};
                for(var k in DEFAULTS){
                    result[k] = DEFAULTS[k];
                }
                for(var k in parsed){
                    result[k] = parsed[k];
                }
                return result;
            } catch(e){
                console.error('bad json', e);
                return DEFAULTS;
            }
        }

        function resetToDefaults(){
            localStorage.removeItem('free_unblocked_games_theme');
            updateUIFromSettings(DEFAULTS);
            applySettings(DEFAULTS);
            updateStarfield(DEFAULTS.starCount, DEFAULTS.starSize, DEFAULTS.starSpeed, DEFAULTS.starColor);
        }

        function updateUIFromSettings(s){
            bgColor.value = s.bg;
            headerColor.value = s.header;
            textColor.value = s.text;
            mutedColor.value = s.muted;
            accentColor.value = s.accent;
            accentDark.value = s.accentDark;
            glowColor.value = s.glowColor;
            cardBg.value = s.cardBg;
            cardRadius.value = s.cardRadius;
            glowSize.value = s.glowSize;
            glowStrength.value = s.glowStrength;
            fontFamily.value = s.fontFamily;
            starColor.value = s.starColor;
            starCount.value = s.starCount;
            starSize.value = s.starSize;
            starSpeed.value = s.starSpeed;
            starCountLabel.textContent = s.starCount;
            starSizeLabel.textContent = s.starSize;
            starSpeedLabel.textContent = s.starSpeed;
        }

        function readSettingsFromUI(){
            var obj = {
                bg: bgColor.value,
                header: headerColor.value,
                text: textColor.value,
                muted: mutedColor.value,
                accent: accentColor.value,
                accentDark: accentDark.value,
                glowColor: glowColor.value,
                cardBg: cardBg.value,
                cardRadius: Number(cardRadius.value),
                glowSize: Number(glowSize.value),
                glowStrength: Number(glowStrength.value),
                fontFamily: fontFamily.value,
                starColor: starColor.value,
                starCount: Number(starCount.value),
                starSize: Number(starSize.value),
                starSpeed: Number(starSpeed.value)
            };
            return obj;
        }

        // Event listeners for settings
        bgColor.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        headerColor.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        textColor.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        mutedColor.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        accentColor.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        accentDark.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        glowColor.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        cardBg.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        cardRadius.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        glowSize.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        glowStrength.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        fontFamily.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        starColor.addEventListener('input', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        starCount.addEventListener('input', function(){
            starCountLabel.textContent = starCount.value;
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        starSize.addEventListener('input', function(){
            starSizeLabel.textContent = starSize.value;
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        starSpeed.addEventListener('input', function(){
            starSpeedLabel.textContent = starSpeed.value;
            var s = readSettingsFromUI();
            applySettings(s);
            if(window.autosaveTimer){
                clearTimeout(window.autosaveTimer);
            }
            window.autosaveTimer = setTimeout(function(){
                saveSettings(s);
            }, 900);
        });

        applyBtn.addEventListener('click', function(){
            var s = readSettingsFromUI();
            applySettings(s);
            saveSettings(s);
        });

        saveBtn.addEventListener('click', function(){
            saveSettings(readSettingsFromUI());
        });

        resetBtn.addEventListener('click', function(){
            if(confirm('Reset to default theme?')){
                resetToDefaults();
            }
        });

        exportBtn.addEventListener('click', function(){
            var data = readSettingsFromUI();
            var json = JSON.stringify(data, null, 2);
            var blob = new Blob([json], {type:'application/json'});
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'theme.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });

        importBtn.addEventListener('click', function(){
            importFile.click();
        });

        importFile.addEventListener('change', function(e){
            var file = e.target.files[0];
            if(!file) return;
            var reader = new FileReader();
            reader.onload = function(){
                try {
                    var data = JSON.parse(reader.result);
                    var merged = {};
                    for(var k in DEFAULTS){
                        merged[k] = DEFAULTS[k];
                    }
                    for(var k in data){
                        merged[k] = data[k];
                    }
                    updateUIFromSettings(merged);
                    applySettings(merged);
                    saveSettings(merged);
                    alert('Imported!');
                } catch(err){
                    alert('Failed to import');
                }
            };
            reader.readAsText(file);
            importFile.value = '';
        });

        // Presets
        var presets = {
            Inferno: {
                bg:'#0a0a0a',
                header:'#1a1a1a',
                text:'#ffffff',
                muted:'#cccccc',
                accent:'#ff00aa',
                accentDark:'#ff00aa',
                glowColor:'#ff00ff',
                cardBg:'#000000',
                cardRadius:12,
                glowSize:25,
                glowStrength:0.5,
                fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                starColor:'#ffffff',
                starCount:160,
                starSize:3,
                starSpeed:1.3
            },
            kirby: {
                bg:'#1A1A2E',
                header:'#1A1A2E',
                text:'#FFFFFF',
                muted:'#F8F1F1',
                accent:'#FF8EC6',
                accentDark:'#A50017',
                glowColor:'#FFC9D1',
                cardBg:'#2B2B45',
                cardRadius:10,
                glowSize:25,
                glowStrength:0.5,
                fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                starColor:'#e660ce',
                starCount:160,
                starSize:3,
                starSpeed:1.4
            },
            mathias: {
                bg:'#000000',
                header:'#000000',
                text:'#a3a3a3',
                muted:'#f8f1f1',
                accent:'#828282',
                accentDark:'#3d3d3d',
                glowColor:'#ffffff',
                cardBg:'#000000',
                cardRadius:10,
                glowSize:25,
                glowStrength:0.5,
                fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                starColor:'#ffffff',
                starCount:160,
                starSize:3,
                starSpeed:1.4
            },
            Ocean: {
                bg:'#021b2c',
                header:'#023047',
                text:'#e8f6ff',
                muted:'#a7d3f0',
                accent:'#00a3ff',
                accentDark:'#006bb3',
                glowColor:'#00baff',
                cardBg:'#00121a',
                cardRadius:12,
                glowSize:18,
                glowStrength:0.28,
                fontFamily:"'Roboto', Arial, sans-serif",
                starColor:'#c8f0ff',
                starCount:120,
                starSize:3,
                starSpeed:0.9
            },
            Neon: {
                bg:'#04040a',
                header:'#0b0b12',
                text:'#e7ffe7',
                muted:'#9ef3d1',
                accent:'#00ffb3',
                accentDark:'#00d18a',
                glowColor:'#00ffb3',
                cardBg:'#05050b',
                cardRadius:8,
                glowSize:30,
                glowStrength:0.5,
                fontFamily:"'VT323', monospace",
                starColor:'#99ffdd',
                starCount:200,
                starSize:2,
                starSpeed:1.6
            },
            Retro: {
                bg:'#0b0011',
                header:'#1a0337',
                text:'#ffe8d6',
                muted:'#ffd6a5',
                accent:'#ff66c4',
                accentDark:'#cc3aa0',
                glowColor:'#ff66c4',
                cardBg:'#140018',
                cardRadius:14,
                glowSize:12,
                glowStrength:0.2,
                fontFamily:"'Press Start 2P', cursive",
                starColor:'#ffd6f0',
                starCount:100,
                starSize:4,
                starSpeed:0.7
            },
            Dark: DEFAULTS,
            Light: {
                bg:'#f4f4f6',
                header:'#ffffff',
                text:'#111111',
                muted:'#666666',
                accent:'#0066ff',
                accentDark:'#0047b3',
                glowColor:'#66a3ff',
                cardBg:'#ffffff',
                cardRadius:8,
                glowSize:10,
                glowStrength:0.12,
                fontFamily:"Arial, Helvetica, sans-serif",
                starColor:'#444444',
                starCount:60,
                starSize:2,
                starSpeed:0.8
            }
        };

        var presetBtns = document.querySelectorAll('[data-preset]');
        for(var i=0; i<presetBtns.length; i++){
            presetBtns[i].addEventListener('click', function(){
                var name = this.getAttribute('data-preset');
                if(presets[name]){
                    var p = presets[name];
                    updateUIFromSettings(p);
                    applySettings(p);
                    saveSettings(p);
                }
            });
        }

        customizeBtn.addEventListener('click', function(){
            if(settingsPanel.style.display === 'block'){
                settingsPanel.style.display = 'none';
            } else {
                settingsPanel.style.display = 'block';
            }
        });

        // Draggable settings panel
        var isDragging = false;
        var dragStartX = 0;
        var dragStartY = 0;
        var panelStartX = 0;
        var panelStartY = 0;

        settingsDrag.addEventListener('mousedown', function(e){
            isDragging = true;
            dragStartX = e.clientX;
            dragStartY = e.clientY;
            var rect = settingsPanel.getBoundingClientRect();
            panelStartX = rect.left;
            panelStartY = rect.top;
        });

        document.addEventListener('mousemove', function(e){
            if(!isDragging) return;
            var dx = e.clientX - dragStartX;
            var dy = e.clientY - dragStartY;
            var newX = panelStartX + dx;
            var newY = panelStartY + dy;

            if(newX < 8) newX = 8;
            if(newY < 8) newY = 8;
            if(newX + settingsPanel.offsetWidth > window.innerWidth - 8){
                newX = window.innerWidth - settingsPanel.offsetWidth - 8;
            }
            if(newY + settingsPanel.offsetHeight > window.innerHeight - 8){
                newY = window.innerHeight - settingsPanel.offsetHeight - 8;
            }

            settingsPanel.style.left = newX + 'px';
            settingsPanel.style.top = newY + 'px';
            settingsPanel.style.right = 'auto';
        });

        document.addEventListener('mouseup', function(){
            isDragging = false;
        });

        // Update starfield function
        function updateStarfield(count, size, speed, color) {
            // Clear existing stars
            stars.length = 0;
            
            // Create new stars with updated properties
            for (let i = 0; i < count; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * size + 0.5,
                    speed: Math.random() * speed + 0.1
                });
            }
            
            // Update star color
            ctx.fillStyle = hexToRGBA(color, 0.8);
        }

        // Discord button
        var discordBtn = document.getElementById("discordBtn");
        discordBtn.addEventListener('click', function(){
            window.open("https://discord.gg/xFMpuKBFr8", "_blank");
        });

        // Game modal functionality
        var gameContainer = document.getElementById("gameContainer");
        var searchInput = document.getElementById("searchInput");
        var gameInfo = document.getElementById("gameInfo").querySelector("p");
        var gameModal = document.getElementById("gameModal");
        var gameFrame = document.getElementById("gameFrame");
        var gameTitle = document.getElementById("gameTitle");
        var closeModal = document.getElementById("closeModal");
        var downloadBtn = document.getElementById("downloadBtn");
        var fullscreenBtn = document.getElementById("fullscreenBtn");
        var aboutBlankBtn = document.getElementById("aboutBlankBtn");
        var blobBtn = document.getElementById("blobBtn");

        closeModal.onclick = function(){
            gameModal.style.display = "none";
            gameFrame.src = "about:blank";
        }

        // Sample games data
        var gamesData = [
            {
                title: "1v1 Lol",
                description: "Build and battle in this 1v1 game",
                image: "https://gcdnb.pbrd.co/images/pedJf1uM7Oe3.jpg",
                url: "https://sites.google.com/ahschools.us/free-math-gamess/games/1v1-lol?authuser=0"
            },
            {
                title: "Mario Kart",
                description: "Race with Mario and friends",
                image: "https://gcdnb.pbrd.co/images/zo1Mbgd5dAut.jpg",
                url: "https://sites.google.com/ahschools.us/free-math-gamess/games/mario-kart?authuser=0"
            },
            {
                title: "Retro Bowl",
                description: "Classic football gaming experience",
                image: "https://gcdnb.pbrd.co/images/IzXAqJC0SJd4.png",
                url: "https://sites.google.com/d/1nQBUMH-lUua_DongjINiZd1LkhmyUCH9/p/14kVcQ9c8iHIVse51JMbPSJpCdqe1VEE_/edit"
            }
        ];

        function renderGames(){
            gameContainer.innerHTML = "";
            for(var i=0; i<gamesData.length; i++){
                var game = gamesData[i];
                var card = document.createElement("div");
                card.className = "game-card";
                card.innerHTML = '<img src="'+game.image+'" alt="'+game.title+'"><h2>'+game.title+'</h2><p>'+game.description+'</p>';
                card.onclick = (function(g){
                    return function(){
                        openGame(g);
                    };
                })(game);
                gameContainer.appendChild(card);
            }
            gameInfo.textContent = 'Games: ' + gamesData.length;
        }

        function openGame(game){
            gameFrame.src = game.url;
            gameTitle.textContent = game.title;
            gameModal.style.display = "flex";
            
            downloadBtn.onclick = function(){
                fetch(game.url)
                .then(function(response){
                    if(!response.ok){
                        throw new Error("Failed");
                    }
                    return response.blob();
                })
                .then(function(blob){
                    var blobUrl = URL.createObjectURL(blob);
                    var a = document.createElement("a");
                    a.href = blobUrl;
                    a.download = game.title + ".html";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(blobUrl);
                })
                .catch(function(err){
                    alert("Download failed");
                });
            };

            fullscreenBtn.onclick = function(){
                if(gameFrame.requestFullscreen){
                    gameFrame.requestFullscreen();
                } else {
                    alert("Fullscreen not supported");
                }
            };

            aboutBlankBtn.onclick = function(){
                var newWindow = window.open("about:blank", "_blank");
                if(newWindow){
                    fetch(game.url)
                    .then(function(r){
                        return r.text();
                    })
                    .then(function(html){
                        newWindow.document.write('<html><head><title>'+game.title+'</title></head><body style="margin:0">'+html+'</body></html>');
                        newWindow.document.close();
                    })
                    .catch(function(err){
                        alert("Failed to open");
                    });
                } else {
                    alert("Popup blocked!");
                }
            };

            blobBtn.onclick = function(){
                fetch(game.url)
                .then(function(res){
                    return res.text();
                })
                .then(function(html){
                    var blob = new Blob([html], {type: "text/html"});
                    var blobUrl = URL.createObjectURL(blob);
                    window.open(blobUrl, "_blank");
                })
                .catch(function(err){
                    alert("Failed");
                });
            };
        }

        searchInput.addEventListener("input", function(){
            var filter = searchInput.value.toLowerCase();
            var cards = gameContainer.children;
            for(var i=0; i<cards.length; i++){
                var card = cards[i];
                var title = card.querySelector("h2").textContent.toLowerCase();
                if(title.indexOf(filter) !== -1){
                    card.style.display = "flex";
                } else {
                    card.style.display = "none";
                }
            }
        });

        // Initialize
        var initial = loadSettings();
        updateUIFromSettings(initial);
        applySettings(initial);
        renderGames();
    </script>
</body>
</html>